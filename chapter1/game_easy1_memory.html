<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เกม Memory</title>

</head>
<style>
body {
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: #f0f0f0;
    margin: 0;
    padding: 20px;
    transition: background-color 1.2s;
}

.game-container {
    text-align: center;
}

.equation-section {
    margin: 20px 0;
    padding: 20px;
    border-radius: 10px;
    background-color: white;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

#equation {
    font-size: 24px;
    margin: 10px 0;
    font-weight: bold;
}

.answer-input {
    padding: 8px;
    font-size: 18px;
    margin: 0 10px;
    border: 2px solid #ddd;
    border-radius: 4px;
    width: 100px;
}

.container {
  display: flex;
  justify-content: center;
  align-items: flex-start;
  margin-top: 2rem;
}

.instructions-container {
  flex: 0 0 300px;
  margin-right: 2rem;
}

.instructions {
  background-color: #f8f8f8;
  border-radius: 10px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  padding: 2rem;
  transition: background-color 0.3s ease;
}

.instructions:hover {
  background-color: #f2f2f2;
}

.instructions h2 {
  font-size: 1.8rem;
  color: #333;
  margin-bottom: 1.5rem;
  text-align: center;
  font-weight: 600;
}

.instructions ol {
  margin: 0;
  padding-left: 1.8rem;
  color: #333333;
  font-size: 1.1rem;
  list-style-type: none;
}

.instructions li {
  margin: 0.8rem 0;
  line-height: 1.5;
  counter-increment: item;
}

.instructions li:before {
  content: counter(item) ". ";
  color: #8B4513;
  font-weight: bold;
  margin-right: 0.5rem;
}

.submit-btn {
    padding: 8px 20px;
    font-size: 18px;
    cursor: pointer;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 4px;
    transition: background-color 0.3s;
}

.submit-btn:hover {
    background-color: #45a049;
}

.memory-board {
    display: grid;
    grid-template-columns: repeat(4, 100px);
    gap: 10px;
    margin-top: 20px;
    perspective: 1000px;
}

.card {
    width: 100px;
    height: 100px;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.6s;
    cursor: pointer;
}

.card.flipped {
    transform: rotateY(180deg);
}

.card-face {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    border-radius: 5px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.card-front {
    background-color: #2196F3;
    transform: rotateY(180deg);
    color: white;
}

.card-back {
    background-color: #ddd;
    background-image: linear-gradient(45deg, #ccc 25%, transparent 25%),
                      linear-gradient(-45deg, #ccc 25%, transparent 25%),
                      linear-gradient(45deg, transparent 75%, #ccc 75%),
                      linear-gradient(-45deg, transparent 75%, #ccc 75%);
    background-size: 20px 20px;
    background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
}

.scores {
    display: flex;
    justify-content: space-around;
    width: 100%;
    max-width: 500px;
    margin: 20px 0;
}

.player-score {
    padding: 10px 20px;
    border-radius: 5px;
    font-size: 18px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

#leftScore {
    background-color: #8B4513;
    color: white;
}

#rightScore {
    background-color: #FFD700;
}

.hint {
    margin-top: 10px;
    color: #666;
    font-style: italic;
}

@keyframes matched {
    0% { transform: rotateY(180deg) scale(1); }
    50% { transform: rotateY(180deg) scale(1.1); }
    100% { transform: rotateY(180deg) scale(1); }
}

.card.matched .card-front {
    animation: matched 0.6s ease-in-out;
    background-color: #4CAF50;
}

.card:hover {
    transition: transform 0.6s;
}
.equation-section {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
  background-color: #f9f9f9;
  border-radius: 10px;
  box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
  margin-top: 20px;
  width: 80%;
  max-width: 400px;
}

.equation-section #equation {
  font-size: 1.5em;
  font-weight: bold;
  color: #333;
  margin-bottom: 15px;
}

.answer-input {
  width: 100%;
  padding: 10px;
  font-size: 1em;
  margin-bottom: 10px;
  border: 1px solid #ccc;
  border-radius: 5px;
  text-align: center;
}

.submit-btn {
  padding: 10px 20px;
  font-size: 1em;
  font-weight: bold;
  color: #fff;
  background-color: #4CAF50;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  transition: background-color 0.3s;
}

.submit-btn:hover {
  background-color: #45a049;
}

.hint {
  margin-top: 10px;
  font-size: 0.9em;
  color: #888;
  text-align: center;
}
.scores {
    display: flex;
    justify-content: center;
    gap: 20px;
    width: 100%;
    max-width: 800px;
    margin: 20px 0;
    flex-wrap: wrap;
}

.player-stats {
    display: flex;
    flex-direction: column;
    gap: 10px;
    min-width: 200px;
}

.player-score {
    padding: 15px;
    border-radius: 8px;
    font-size: 18px;
    font-weight: bold;
    text-align: center;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
}

.player-score:hover {
    transform: translateY(-2px);
}

/* สไตล์สำหรับ HP bar */
.hp-container {
    background-color: #f0f0f0;
    border-radius: 8px;
    padding: 10px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.hp-bar {
    width: 100%;
    height: 20px;
    background-color: #e0e0e0;
    border-radius: 10px;
    overflow: hidden;
    position: relative;
}

.hp-fill {
    height: 100%;
    background: linear-gradient(90deg, #ff4646 0%, #ff7676 100%);
    transition: width 0.3s ease;
    border-radius: 10px;
    position: relative;
}

.hp-text {
    position: absolute;
    width: 100%;
    text-align: center;
    color: white;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    line-height: 20px;
    font-size: 14px;
}

/* สไตล์เฉพาะสำหรับแต่ละผู้เล่น */
#leftScore {
    background-color: #8B4513;
    color: white;
}

#rightScore {
    background-color: #FFD700;
    color: #333;
}

.left-hp .hp-fill {
    background: linear-gradient(90deg, #8B4513 0%, #A0522D 100%);
}

.right-hp .hp-fill {
    background: linear-gradient(90deg, #DAA520 0%, #FFD700 100%);
}

/* ปรับ animation เมื่อ HP เปลี่ยน */
@keyframes hpChange {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.hp-changed {
    animation: hpChange 0.3s ease;
}

</style>
<body>
<div class="container">
  <div class="instructions-container">
    <div class="instructions">
      <h2>วิธีการเล่นเกม Memory</h2>
      <ol>
        <li><strong>แก้สมการ</strong>: แก้สมการทางคณิตศาสตร์ เมื่อแก้สมการถูกต้อง จะมีโอกาสได้เปิดการ์ด</li>
        <li><strong>จับคู่การ์ด</strong>: หากการ์ดที่เปิดออกมาเป็นเลขเดียวกัน ผู้เล่นจะได้รับ 1 คะแนน</li>
        <li><strong>แก้สมการผิด</strong>: หากผู้เล่นคนแรกแก้สมการไม่ถูก จะลด HP 10หน่วย และอีกฝั่งมีโอกาสได้แก้สมการนี้</li>
        <li><strong>สะสมคะแนน</strong>: ผู้เล่นที่เปิดกการ์ดได้มากที่สุด จะเป็นผู้ชนะ</li>
      </ol>
    </div>
  </div>

  <div class="game-container">
    <div class="scores">
      <div class="player-stats">
        <div id="leftScore" class="player-score">ผู้เล่น 1: 0</div>
        <div class="hp-container left-hp">
          <div class="hp-bar">
            <div class="hp-fill" style="width: 100%">
              <div id="leftHP" class="hp-text">HP: 30/30</div>
            </div>
          </div>
        </div>
      </div>
      <div class="player-stats">
        <div id="rightScore" class="player-score">ผู้เล่น 2: 0</div>
        <div class="hp-container right-hp">
          <div class="hp-bar">
            <div class="hp-fill" style="width: 100%">
              <div id="rightHP" class="hp-text">HP: 30/30</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="equation-section">
      <div id="equation">โจทย์: </div>
      <input type="number" class="answer-input" id="answer" placeholder="คำตอบ">
      <button class="submit-btn" onclick="checkAnswer()">ตอบ</button>
      <div id="hint" class="hint"></div>
    </div>

    <div class="memory-board" id="board"></div>
  </div>
</div>
<script>
// ตัวแปรควบคุมเกม
let currentPlayer = 'left';
let scores = { left: 0, right: 0 };
let playerHP = { left: 30, right: 30 };
let firstCard = null;
let secondCard = null;
let canFlip = false;
let lockBoard = false;
let totalPairs = 8;
let currentEquation = null;

const numbers = Array.from({length: totalPairs}, (_, i) => i + 1);
const cards = [...numbers, ...numbers];
let shuffledCards = [];

// ฟังก์ชันสุ่มตัวเลขจำนวนเต็ม
function getRandomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

// ฟังก์ชันสุ่มสมการ
function generateEquation() {
    const equationType = getRandomInt(1, 5);
    const x = getRandomInt(-10, 10); // สุ่มค่า x ที่เป็นตัวเลขจำนวนเต็ม
    let equation, answer;

    while (true) {
      switch (equationType) {
          case 1: // ax + b = c
              const a1 = getRandomInt(1, 5);
              const b1 = getRandomInt(-10, 10);
              equation = `${a1}x + ${b1} = ${a1 * x + b1}`;
              answer = x;
              break;

          case 2: // ax = bx + c
              const a2 = getRandomInt(2, 6);
              const b2 = getRandomInt(1, a2 - 1);
              const c2 = (a2 - b2) * x;
              equation = `${a2}x = ${b2}x + ${c2}`;
              answer = x;
              break;

          case 3: // (ax + b)/c = d
              const c3 = getRandomInt(2, 4);
              const a3 = getRandomInt(1, 5) * c3;
              const b3 = getRandomInt(-10, 10);
              const d3 = Math.floor((a3 * x + b3) / c3);
              equation = `(${a3}x + ${b3})/${c3} = ${d3}`;
              answer = x;
              break;

          case 4: // ax + b = cx + d
              const a4 = getRandomInt(2, 6);
              const c4 = getRandomInt(1, a4 - 1);
              const b4 = getRandomInt(-10, 10);
              const d4 = b4 - (a4 - c4) * x;
              equation = `${a4}x + ${b4} = ${c4}x + ${d4}`;
              answer = x;
              break;

          case 5: // a(x + b) = c
              const a5 = getRandomInt(1, 5);
              const b5 = getRandomInt(-5, 5);
              const c5 = a5 * (x + b5);
              equation = `${a5}(x + ${b5}) = ${c5}`;
              answer = x;
              break;
      }
              if (answer !== null) {
            break;
        }
    }
    // ทำให้สมการสวยงามขึ้น
    equation = equation
        .replace(/\+ -/g, '- ')        // แทนที่ "+ -" ด้วย "- "
        .replace(/ 1x/g, ' x')         // แทนที่ "1x" ด้วย "x"
        .replace(/^1x/, 'x')           // แทนที่ "1x" ที่อยู่ต้นสมการด้วย "x"
        .replace(/ \+ 0/g, '')         // ลบ "+ 0" ออก
        .replace(/ - 0/g, '');         // ลบ "- 0" ออก

    // เพิ่ม logging เพื่อ debug
    console.log('Generated equation:', equation);
    console.log('Correct answer:', answer);
    
    return { equation, answer };
}
// ฟังก์ชันตรวจสอบคำตอบ
function checkAnswer() {
    if (!currentEquation) {
        currentEquation = generateEquation();
        return;
    }

    const userInputValue = document.getElementById('answer').value.trim();
    const userAnswer = Number(userInputValue);
    const correctAnswer = Number(currentEquation.answer);
    const hintElement = document.getElementById('hint');

    if (userInputValue === '') {
        hintElement.innerHTML = '<span style="color: red;">กรุณาป้อนคำตอบ</span>';
        return;
    }

    if (isNaN(userAnswer) || !Number.isInteger(userAnswer)) {
        hintElement.innerHTML = '<span style="color: red;">กรุณาป้อนเฉพาะตัวเลขจำนวนเต็มเท่านั้น</span>';
        return;
    }

    if (userAnswer === correctAnswer) {
        canFlip = true;
        document.body.style.backgroundColor = currentPlayer === 'left' ? '#8B4513' : '#FFD700';
        hintElement.innerHTML = '<span style="color: green;">ยินดีด้วย! คุณตอบถูก คลิกที่การ์ดเพื่อเล่นได้เลย!!</span>';
    } else {
        canFlip = false;
        hintElement.innerHTML = '<span style="color: red;">เสียใจด้วย! คุณตอบผิด</span>';
        // ลด HP เมื่อตอบผิด
        playerHP[currentPlayer] -= 10;
        // อัพเดท HP บนหน้าจอ
        updateHPDisplay();
        // ตรวจสอบว่ามีผู้เล่นคนไหน HP หมดหรือไม่
        if (checkPlayerDeath()) {
            return; // ถ้ามีคนแพ้แล้วให้หยุดการทำงานของฟังก์ชัน
        }
        lockBoard = true;
        setTimeout(() => {
            lockBoard = false;
            // สลับผู้เล่นเมื่อตอบผิด
            currentPlayer = currentPlayer === 'left' ? 'right' : 'left';
            document.body.style.backgroundColor = currentPlayer === 'left' ? '#8B4513' : '#FFD700';
            // สร้างโจทย์ใหม่
            currentEquation = generateEquation();
            document.getElementById('equation').textContent = `โจทย์: ${currentEquation.equation}`;
        }, 1000);
    }

    document.getElementById('answer').value = '';
}

function updateHPDisplay() {
    const maxHP = 30; // HP สูงสุด
    
    // อัพเดท HP ผู้เล่น 1
    const leftHPPercent = (playerHP.left / maxHP) * 100;
    const leftHPFill = document.querySelector('.left-hp .hp-fill');
    leftHPFill.style.width = `${Math.max(leftHPPercent, 0)}%`;
    document.getElementById('leftHP').textContent = `HP: ${playerHP.left}/${maxHP}`;
    
    // อัพเดท HP ผู้เล่น 2
    const rightHPPercent = (playerHP.right / maxHP) * 100;
    const rightHPFill = document.querySelector('.right-hp .hp-fill');
    rightHPFill.style.width = `${Math.max(rightHPPercent, 0)}%`;
    document.getElementById('rightHP').textContent = `HP: ${playerHP.right}/${maxHP}`;

    // เพิ่ม animation เมื่อ HP เปลี่ยน
    const hpContainers = document.querySelectorAll('.hp-container');
    hpContainers.forEach(container => {
        container.classList.add('hp-changed');
        setTimeout(() => container.classList.remove('hp-changed'), 300);
    });
}

// ฟังก์ชันสร้างการ์ด
function createBoard() {
    shuffledCards = [...cards].sort(() => Math.random() - 0.5);
    const board = document.getElementById('board');
    board.innerHTML = '';
    
    shuffledCards.forEach((number, index) => {
        const card = document.createElement('div');
        card.classList.add('card');
        card.setAttribute('data-index', index);
        card.setAttribute('data-value', number);
        
        const cardFront = document.createElement('div');
        cardFront.classList.add('card-face', 'card-front');
        cardFront.textContent = number;
        
        const cardBack = document.createElement('div');
        cardBack.classList.add('card-face', 'card-back');
        
        card.appendChild(cardFront);
        card.appendChild(cardBack);
        card.addEventListener('click', flipCard);
        board.appendChild(card);
    });
}
// ฟังก์ชันพลิกการ์ด
function flipCard() {
    if (lockBoard || !canFlip || this === firstCard) return;
    
    this.classList.add('flipped');

    if (!firstCard) {
        firstCard = this;
        return;
    }

    secondCard = this;
    checkForMatch();
}

// ฟังก์ชันตรวจสอบการ์ดที่จับคู่
function checkForMatch() {
    const isMatch = firstCard.getAttribute('data-value') === secondCard.getAttribute('data-value');

    if (isMatch) {
        firstCard.classList.add('matched');
        secondCard.classList.add('matched');
        scores[currentPlayer]++;
        document.getElementById(`${currentPlayer}Score`).textContent = 
            `ผู้เล่น ${currentPlayer === 'left' ? '1' : '2'}: ${scores[currentPlayer]}`;
        disableCards();
        
        // ตรวจสอบว่าจบเกมหรือไม่
        checkGameOver();
    } else {
        unflipCards();
        // ไม่ต้องลด HP ของผู้เล่นที่ตอบผิด
    }

    canFlip = false;
    currentPlayer = currentPlayer === 'left' ? 'right' : 'left';
    document.body.style.backgroundColor = currentPlayer === 'left' ? '#8B4513' : '#FFD700';
    
    currentEquation = generateEquation();
    document.getElementById('equation').textContent = `โจทย์: ${currentEquation.equation}`;
}
// ฟังก์ชันตรวจสอบผู้เล่นที่หมด HP
function checkPlayerDeath() {
    if (playerHP.left <= 0) {
        declareWinner('right');
        return true;
    } else if (playerHP.right <= 0) {
        declareWinner('left');
        return true;
    }
    return false;
}
// ฟังก์ชันปิดการ์ดที่จับคู่แล้ว
function disableCards() {
    firstCard.removeEventListener('click', flipCard);
    secondCard.removeEventListener('click', flipCard);
    resetBoard();
}

// ฟังก์ชันพลิกการ์ดกลับ
function unflipCards() {
    lockBoard = true;
    setTimeout(() => {
        firstCard.classList.remove('flipped');
        secondCard.classList.remove('flipped');
        resetBoard();
    }, 1000);
}

// รีเซ็ตตัวแปรการ์ด
function resetBoard() {
    [firstCard, secondCard] = [null, null];
    lockBoard = false;
}

// ฟังก์ชันตรวจสอบการจบเกม
function checkGameOver() {
    const totalMatched = document.querySelectorAll('.matched').length / 2; // จำนวนคู่ที่จับคู่ได้
    if (totalMatched === totalPairs) {
        declareWinner();
    }
}

// ฟังก์ชันประกาศผู้ชนะ
function declareWinner(winner = null) {
    let message;
    if (winner) {
        // กรณีชนะเพราะฝ่ายตรงข้าม HP หมด
        message = winner === 'left' ? 
            `จบเกม! ผู้เล่น 1 ชนะ เนื่องจากผู้เล่น 2 HP หมด! (คะแนน ${scores.left} คะแนน)` :
            `จบเกม! ผู้เล่น 2 ชนะ เนื่องจากผู้เล่น 1 HP หมด! (คะแนน ${scores.right} คะแนน)`;
    } else {
        // กรณีชนะเพราะจับคู่การ์ดได้ครบ
        const winner = scores.left > scores.right ? 'left' : 'right';
        message = winner === 'left' ? 
            `จบเกม! ผู้เล่น 1 ชนะ ด้วยคะแนน ${scores.left} คะแนน!` :
            `จบเกม! ผู้เล่น 2 ชนะ ด้วยคะแนน ${scores.right} คะแนน!`;
    }
    
    setTimeout(() => {
        alert(message);
        resetGame();
    }, 500);
}

// ฟังก์ชันรีเซ็ตเกม - ปรับปรุงใหม่
function resetGame() {
    // รีเซ็ตคะแนน
    scores = { left: 0, right: 0 };
    // รีเซ็ต HP
    playerHP = { left: 30, right: 30 };
    
    // อัพเดตคะแนนบนหน้าจอ
    document.getElementById('leftScore').textContent = 'ผู้เล่น 1: 0';
    document.getElementById('rightScore').textContent = 'ผู้เล่น 2: 0';
    
    // อัพเดต HP text
    document.getElementById('leftHP').textContent = 'HP: 30/30';
    document.getElementById('rightHP').textContent = 'HP: 30/30';
    
    // อัพเดตแถบ HP
    updateHPDisplay();
    
    // สร้างบอร์ดใหม่
    createBoard();
    
    // รีเซ็ตผู้เล่นเริ่มต้น
    currentPlayer = 'left';
    document.body.style.backgroundColor = '#8B4513';
    
    // สร้างโจทย์ใหม่
    currentEquation = generateEquation();
    document.getElementById('equation').textContent = `โจทย์: ${currentEquation.equation}`;
}

// เริ่มเกม
function initGame() {
    resetGame();
}

// ใช้ DOMContentLoaded แทน window.onload
document.addEventListener('DOMContentLoaded', function() {
    initGame();
});

</script>
</body>
</html>